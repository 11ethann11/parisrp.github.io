<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Paris RP FR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #c9d1d9; } </style>
</head>
<body class="antialiased">

    <!-- Écran de Connexion -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-sm bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700">
            <div class="text-center mb-8"><img src="https://i.ibb.co/QnCgmnS/Paris-RP-FR.png" alt="Logo" class="w-20 h-20 mx-auto rounded-full mb-4 border-2 border-indigo-500" />
                <h1 class="text-2xl font-bold">Administration</h1><p class="text-gray-400">Paris RP FR</p>
            </div>
            <form id="login-form" class="space-y-6">
                <div><label for="email-input" class="block text-sm font-medium text-gray-300 mb-1">Email</label><input id="email-input" type="email" class="w-full bg-gray-900 border border-gray-600 rounded-md px-3 py-2 text-white" required></div>
                <div><label for="password-input" class="block text-sm font-medium text-gray-300 mb-1">Mot de passe</label><input id="password-input" type="password" class="w-full bg-gray-900 border border-gray-600 rounded-md px-3 py-2 text-white" required></div>
                <p id="auth-error" class="text-red-400 text-sm text-center h-4"></p>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-md transition">Se Connecter</button>
            </form>
        </div>
    </div>

    <!-- Panneau d'Administration (caché) -->
    <div id="admin-panel" class="hidden">
        <header class="bg-gray-800/80 backdrop-blur-md border-b border-gray-700 sticky top-0 z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-20">
                <h1 class="text-xl font-bold">Panneau d'Administration</h1>
                <div><span id="save-status" class="text-sm mr-4"></span><button id="save-changes-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-5 rounded-md transition">Sauvegarder</button><button id="logout-btn" class="ml-4 text-gray-400 hover:text-white transition">Déconnexion</button></div>
            </div>
        </header>
        <main class="container mx-auto p-4 sm:p-6 lg:p-8">
            <div id="admin-form-container" class="space-y-8">
                <!-- FORMULAIRE HARD-CODÉ -->
                <div class="bg-gray-900/50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-indigo-400 border-b border-gray-700 pb-2">Général</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-1">Titre Global du Site</label><input type="text" data-key="site_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Sous-titre Global du Site</label><input type="text" data-key="site_subtitle" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                    </div>
                </div>
                <div class="bg-gray-900/50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-indigo-400 border-b border-gray-700 pb-2">Accueil</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-1">Titre d'Accueil</label><input type="text" data-key="home_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Paragraphe d'Accueil</label><textarea data-key="home_subtitle" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="3"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Titre Section 'Pourquoi Notre Communauté'</label><input type="text" data-key="community_section_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Titre Carte 1</label><input type="text" data-key="card1_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Texte Carte 1</label><textarea data-key="card1_text" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="2"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Titre Carte 2</label><input type="text" data-key="card2_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Texte Carte 2</label><textarea data-key="card2_text" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="2"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Titre Carte 3</label><input type="text" data-key="card3_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Texte Carte 3</label><textarea data-key="card3_text" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="2"></textarea></div>
                    </div>
                </div>
                <div class="bg-gray-900/50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-indigo-400 border-b border-gray-700 pb-2">Pages de Contenu</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-1">Titre 'À Propos'</label><input type="text" data-key="about_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Contenu 'À Propos' (HTML)</label><textarea data-key="about_content" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="5"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Titre 'Règlement'</label><input type="text" data-key="rules_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Contenu 'Règlement' (HTML)</label><textarea data-key="rules_content" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="5"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Titre 'Rejoindre'</label><input type="text" data-key="join_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Contenu 'Rejoindre' (HTML)</label><textarea data-key="join_content" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="5"></textarea></div>
                         <div><label class="block text-sm font-semibold mb-1">Titre 'Contact'</label><input type="text" data-key="contact_title" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Contenu 'Contact' (HTML)</label><textarea data-key="contact_content" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2" rows="5"></textarea></div>
                    </div>
                </div>
                 <div class="bg-gray-900/50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-indigo-400 border-b border-gray-700 pb-2">Pied de Page</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-1">Copyright</label><input type="text" data-key="footer_copyright" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                        <div><label class="block text-sm font-semibold mb-1">Disclaimer</label><input type="text" data-key="footer_disclaimer" class="admin-input w-full bg-gray-800 border border-gray-600 rounded-md p-2"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyCHxZvMq227zpskRJi4oCANh1T1Yq3MAjU", authDomain: "parisrpfr-roblox.firebaseapp.com", projectId: "parisrpfr-roblox", storageBucket: "parisrpfr-roblox.firebasestorage.app", messagingSenderId: "282300950781", appId: "1:282300950781:web:0a3d9eeeb58563dbe43694" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const authError = document.getElementById('auth-error');
        const logoutBtn = document.getElementById('logout-btn');
        const saveChangesBtn = document.getElementById('save-changes-btn');
        const saveStatus = document.getElementById('save-status');
        const contentRef = doc(db, "websiteContent", "mainPage");
        const allAdminInputs = document.querySelectorAll('.admin-input');

        async function populateFormWithData() {
            try {
                const docSnap = await getDoc(contentRef);
                const data = docSnap.exists() ? docSnap.data() : {};
                allAdminInputs.forEach(input => {
                    const key = input.dataset.key;
                    if (data[key] !== undefined) {
                        input.value = data[key];
                    }
                });
            } catch (error) {
                console.error("Erreur de chargement des données:", error);
                alert("Impossible de charger les données. Vérifiez les règles de sécurité Firestore.");
            }
        }
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginScreen.classList.add('hidden');
                adminPanel.classList.remove('hidden');
                populateFormWithData();
            } else {
                loginScreen.classList.remove('hidden');
                adminPanel.classList.add('hidden');
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            authError.textContent = '';
            try {
                const email = document.getElementById('email-input').value;
                const password = document.getElementById('password-input').value;
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                authError.textContent = 'Email ou mot de passe incorrect.';
            }
        });
        
        logoutBtn.addEventListener('click', () => signOut(auth));

        saveChangesBtn.addEventListener('click', async () => {
            saveStatus.textContent = "Sauvegarde...";
            saveStatus.className = "text-sm mr-4 text-yellow-400";
            const dataToSave = {};
            allAdminInputs.forEach(input => {
                dataToSave[input.dataset.key] = input.value;
            });
            try {
                await setDoc(contentRef, dataToSave);
                saveStatus.textContent = "Modifications sauvegardées !";
                saveStatus.className = "text-sm mr-4 text-green-400";
            } catch (error) {
                saveStatus.textContent = "Erreur de sauvegarde.";
                saveStatus.className = "text-sm mr-4 text-red-400";
            } finally {
                setTimeout(() => { saveStatus.textContent = "" }, 3000);
            }
        });
    </script>
</body>
</html>
